<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<title layout:fragment="title">myParty | RSVP</title>
<section layout:fragment="content">

    <h1>Complete Your RSVP</h1>

    <!--Show The Party Info-->
    <div>
        <div th:text="${party.title}"></div>
        <div th:text="${party.description}"></div>
        <div th:text="'Start Time: ' + ${party.startTime}"></div>
        <div th:text="'End Time: ' + ${party.endTime}"></div>
        <div th:text="'Organizer: ' + ${party.owner.firstName + ' ' + party.owner.lastName}"></div>
        <div th:text="'Location: ' + ${party.location.addressOne} + ', ' + ${party.location.city} + ', ' + ${party.location.state} + ', ' + ${party.location.zipcode}"></div>
        <!--TODO: Logic to show addressTwo if not null-->
    </div>

    <!--Member RSVP Form-->
    <div sec:authorize="isAuthenticated()">
        <h1>Member form works!</h1>
        <form th:action="@{|/rsvp/${party.urlKey}/${member.id}|}" th:method="post" th:object="${partyMember}">

            <!--Prefilled Member Information-->
            <div th:text="'Name: ' + ${member.firstName} + ' ' + ${member.lastName} "></div>
            <div th:text="'Email: ' + ${member.email}"></div>

            <!--Enter RSVP Status-->
            <div class="form-group">
                <label for="rsvp1">RSVP: </label>
                <select id="rsvp1" name="rsvp">
                    <div th:each="rsvp: ${rsvps}">
                        <option th:value="${rsvp}" th:text="${rsvp}"></option>
                    </div>
                </select>
            </div>

            <div class="form-group">
                <label for="additionalGuests1">Additional Guests You're Bringing: </label>
                <select id="additionalGuests1" th:field="*{additionalGuests}">
                    <div th:each="additionalGuest : ${additionalGuests}">
                        <option th:value="${additionalGuest}" th:text="${additionalGuest}"></option>
                    </div>
                </select>
            </div>

            <!--Sign Up For Items -->
            <div class="form-group">
                <table>
                    <tr>
                        <th>Item</th>
                        <th>Quantity Requested</th>
                        <th>Quantity You're Bringing</th>
                    </tr>

                    <div th:each="partyItem : ${partyItems}">
                        <tr class="form-group">
                            <td th:text="${partyItem.key.item.name}"></td>
                            <td th:text="${partyItem.key.quantityRequired}"></td>
                            <td>
                                <select name="quantity[]">
                                    <option th:each="quantity : ${partyItem.value}" th:text="${quantity}" th:value="${quantity}"></option>
                                </select>
                            </td>
                            <input type="hidden" name="partyItem[]" th:value="${partyItem.key.id}">
                            <br>
                        </tr>
                    </div>

                </table>
            </div>
            <input type="submit" value="Submit"/>
        </form>
    </div>

    <!--Guest RSVP Form-->
    <div sec:authorize="isAnonymous()">
        <form th:action="@{|/rsvp/${party.urlKey}|}" th:method="post" th:object="${guest}" >

            <a href="/login">Have an account? Log in here</a>

            <!--Enter First Name-->
            <div class="form-group">
                <label for="firstName">First Name: </label>
                <input class="form-control" id="firstName" type="text" th:field="*{firstName}"/>
            </div>

            <!--Enter Last Name-->
            <div class="form-group">
                <label for="lastName">Last Name: </label>
                <input class="form-control" id="lastName" type="text" th:field="*{lastName}"/>
            </div>

            <!--Enter Email-->
            <div class="form-group">
                <label for="email">Email: </label>
                <input class="form-control" id="email" type="text" th:field="*{email}"/>
            </div>

            <!--Enter RSVP Status-->
            <div class="form-group">
                <label for="rsvp">RSVP: </label>
                <select id="rsvp" name="rsvp">
                    <div th:each="rsvp: ${rsvps}">
                        <option th:value="${rsvp}" th:text="${rsvp}"></option>
                    </div>
                </select>
            </div>

            <div class="form-group">
                <label for="additionalGuests">Additional Guests You're Bringing: </label>
                <select id="additionalGuests" th:field="*{additionalGuests}">
                    <div th:each="additionalGuest : ${additionalGuests}">
                        <option th:value="${additionalGuest}" th:text="${additionalGuest}"></option>
                    </div>
                </select>
            </div>


            <!--Sign Up For Items -->
            <div class="form-group">
                <table>
                    <tr>
                        <th>Item</th>
                        <th>Quantity Requested</th>
                        <th>Quantity You're Bringing</th>
                    </tr>

                    <div th:each="partyItem : ${partyItems}">
                        <tr class="form-group">
                            <td th:text="${partyItem.key.item.name}"></td>
                            <td th:text="${partyItem.key.quantityRequired}"></td>
                            <td>
                                <select name="quantity[]">
                                    <option th:each="quantity : ${partyItem.value}" th:text="${quantity}" th:value="${quantity}"></option>
                                </select>
                            </td>
                            <input type="hidden" name="partyItem[]" th:value="${partyItem.key.id}">
                            <br>
                        </tr>
                    </div>

                </table>
            </div>

            <input type="submit" value="Submit"/>
        </form>
    </div>

</section>

<footer><p layout:fragment="custom-footer">This is actually working</p></footer>
</html>